<!DOCTYPE HTML>

<html>
<head>
    <title>Amazon SCSAI Team - Blog</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <!-- MathJax Configuration -->
    <script type="text/javascript">
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                ignoreHtmlClass: 'tex2jax_ignore'
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
</head>
<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Header -->
        <header id="header">
            <h1><a href="index.html">Amazon SCSAI</a></h1>
        </header>

        <!-- Main -->
        <div id="main" style="width: 80%; margin: 0 auto; padding: 20px;">
            <article class="post">
                <header>
                    <div class="title">
                        <h2 id="blog-title">Loading...</h2>
                    </div>
                    <div class="meta">
                        <time class="published" id="blog-date"></time>
                        <a href="#" class="author"><span class="name">Amazon SCSAI</span></a>
                    </div>
                </header>
                <div id="blog-content" class="content">
                    <p>Loading content...</p>
                </div>
            </article>
        </div>

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const postFile = urlParams.get('post');

        if (postFile) {
            const postPath = `posts/${postFile}`;

            fetch(postPath)
                .then(response => {
                    if (!response.ok) throw new Error("Failed to load blog content.");
                    return response.text();
                })
                .then(markdown => {
                    // Configure Showdown with MathJax inline processing
                    const converter = new showdown.Converter({
                        literalMidWordUnderscores: true,
                        extensions: [{
                            type: 'lang',
                            regex: /(?<!\\)\$(.+?)\$/g,
                            replace: '\\($1\\)'
                        }]
                    });

                    const html = converter.makeHtml(markdown);

                    // Extract the first <h1> tag as the title
                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = html;
                    const titleElement = tempDiv.querySelector("h1");
                    const title = titleElement ? titleElement.textContent : "Untitled";

                    // Set the blog title
                    document.getElementById("blog-title").textContent = title;

                    // Remove the <h1> from the blog content and display the rest
                    if (titleElement) titleElement.remove();
                    document.getElementById("blog-content").innerHTML = tempDiv.innerHTML;

                    // Re-render MathJax equations
                    MathJax.typesetPromise()
                        .then(() => console.log("MathJax rendering complete."))
                        .catch(err => console.error("MathJax rendering error:", err));
                })
                .catch(error => {
                    document.getElementById("blog-content").innerHTML = `<p>Error: ${error.message}</p>`;
                    console.error(error);
                });
        } else {
            document.getElementById("blog-content").innerHTML = '<p>Error: No blog post specified.</p>';
        }
    </script>
</body>
</html>
